````markdown
# Rusia Signal Bot

**Rusia Signal Bot**

Данный проект представляет собой бот для автоматизированной генерации и отправки торговых сигналов. Он реализован на языке Python и состоит из нескольких модулей, которые обеспечивают сбор данных, расчеты торговой стратегии, управление капиталом и взаимодействие с пользователями через чат-бота и/или веб-интерфейс.

> **Важно для других ИИ**: В этом README описаны архитектура, компоненты и принципы работы проекта с целью облегчить автоматический анализ и последующую модификацию/адаптацию системы.

---
## Содержание

1. [Структура проекта](#структура-проекта)
2. [Требования](#требования)
3. [Установка и настройка](#установка-и-настройка)
4. [Описание модулей](#описание-модулей)
   - `config.py`
   - `data_provider.py`
   - `strategy.py`
   - `money.py`
   - `models.py`
   - `bot.py`
   - `app_server.py`
   - `main.py`
   - `analytics.html` и `index.html`
5. [Принцип работы и поток данных](#принцип-работы-и-поток-данных)
6. [Запуск проекта](#запуск-проекта)
7. [Примеры использования](#примеры-использования)
8. [Рекомендации по расширению](#рекомендации-по-расширению)
9. [Лицензия](#лицензия)

---
## Структура проекта

```text
Rusia_Signal_Bot/
├── analytics.html      # Статический веб-отчет/дашборд для аналитики
├── index.html          # Веб-страница (интерфейс) для отображения сводных данных
├── config.py           # Файл конфигурации (API-ключи, параметры стратегии и т.д.)
├── data_provider.py    # Модуль сбора и обработки внешних данных (рыночные данные, API)
├── strategy.py         # Логика торговой стратегии (расчет сигналов)
├── money.py            # Управление капиталом и рисками (позиции, лотность)
├── models.py           # Определение классов/структур данных (DTO, ORM-модели)
├── bot.py              # Модуль чат-бота (Telegram/Discord) для отправки сигналов
├── app_server.py       # Веб-сервер (например, Flask/FastAPI) для публичного доступа к интерфейсу
├── main.py             # Основной скрипт для запуска всех компонентов (точка входа)
├── strategy.py         # (указан ранее, здесь для полноты)
├── requirements.txt    # Зависимости проекта (версии библиотек)
├── models.py           # (повтор) Определения основных моделей данных
└── README.md           # (этот файл) Подробная документация
````

Каждый файл отвечает за свою часть функционала; вместе они формируют сквозной конвейер от получения данных до отправки сигналов и отображения аналитики.

---

## Требования

1. **Операционная система**: Linux, macOS, Windows (с Python 3.8+).
2. **Python**: версия 3.8 или выше.
3. **Библиотеки**:

   * `requests` (или любая библиотека HTTP-клиента для API)
   * `pandas` (для работы с табличными данными и аналитики)
   * `numpy` (для численных расчетов)
   * `sqlalchemy` (если используется база данных, как это видно по `models.py`)
   * `python-telegram-bot` или `discord.py` (в зависимости от типа чат-бота)
   * `flask` или `fastapi` (для веб-сервера `app_server.py`)
   * Другие зависимости, перечисленные в `requirements.txt`.

Убедитесь, что у вас установлен `pip` (или `pipenv`/`poetry` для виртуального окружения).

---

## Установка и настройка

1. **Клонировать репозиторий**:

   ```bash
   git clone https://github.com/Ruslan1908/Rusia_Signal_Bot.git
   cd Rusia_Signal_Bot
   ```

2. **Создать виртуальное окружение** (рекомендуется):

   ```bash
   python3 -m venv venv
   source venv/bin/activate  # Linux/macOS
   venv\Scripts\activate     # Windows
   ```

3. **Установить зависимости**:

   ```bash
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

4. **Настройка конфигурации**:

   * Откройте `config.py`. В этом файле находятся настройки:

     * Параметры доступа к API биржи (например, `EXCHANGE_API_KEY`, `EXCHANGE_API_SECRET`).
     * Настройки для чат-бота (токены Telegram/Discord).
     * Параметры стратегии (периоды скользящих средних, уровни стоп-лосс/тейк-профит и т.д.).
     * Настройки базы данных (`DB_URI`).
     * Любые другие флаги и переменные, влияющие на поведение скриптов.
   * Заполните все необходимые поля своими значениями.

5. **Подготовка базы данных** (если используется SQLAlchemy или иной ORM):

   ```bash
   python main.py --init-db
   ```

   Это создаст таблицы в базе данных по моделям, описанным в `models.py`.

---

## Описание модулей

### 1. `config.py`

* **Назначение**: Хранение глобальных настроек и констант.
* **Содержимое**:

  * `API_KEY`, `API_SECRET` для подключения к бирже.
  * `BOT_TOKEN` (Telegram или Discord).
  * Стратегические параметры (например, `SHORT_MA_PERIOD`, `LONG_MA_PERIOD`).
  * Параметры риск-менеджмента (`MAX_DRAWDOWN`, `RISK_PER_TRADE`).
  * Настройки логирования (уровень логов, путь к файлам).
  * `DB_URI` для подключения к базе данных.

> **Совет для ИИ**: При изменении параметров стратегии обновление происходит динамически — достаточно изменить значения констант в `config.py`.

---

### 2. `data_provider.py`

* **Назначение**: Сбор исторических и/или реальных данных с биржи или других источников.
* **Основные функции**:

  * `get_historical_data(symbol: str, timeframe: str) -> DataFrame`: Загружает исторические данные.
  * `subscribe_realtime(symbol: str)`: Подписывается на потоковые данные (WebSocket или REST-поллинг).
  * `format_data(raw_data) -> DataFrame`: Преобразует «сырые» данные в структуру `pandas.DataFrame` для дальнейшего анализа.

> Данные кешируются/сохраняются (при необходимости) для избежания частых запросов.

---

### 3. `strategy.py`

* **Назначение**: Логика вычисления торговых сигналов (например, пересечение скользящих средних, индикаторы RSI и т.д.).
* **Основные компоненты**:

  * Класс `Strategy`:

    * Метод `generate_signal(data: DataFrame) -> str`: Возвращает строку сигнала (`"BUY"`, `"SELL"`, `"HOLD"`).
    * Внутри используются параметризованные функции для расчета индикаторов.
  * Примеры индикаторов:

    * `calculate_sma(data, period)`,
    * `calculate_rsi(data, period)`.

> **Важно**: Стратегия может быть легко расширена или заменена — достаточно наследовать класс `Strategy` и реализовать метод `generate_signal`.

---

### 4. `money.py`

* **Назначение**: Управление капиталом, расчет объема сделки, лимитов риска.
* **Основные функции и классы**:

  * `MoneyManager`:

    * Метод `calculate_position_size(balance: float, risk: float, stop_loss_distance: float) -> float`: Вычисляет размер позиции.
    * Метод `update_balance(outcome: float)`: Обновляет баланс в зависимости от заполненного ордера.
  * Логика уровней стоп-лосс/тейк-профит, модуль управления рисками `drawdown_control`.

> Капитал может храниться в файле/базе данных, если реализовано в `models.py`.

---

### 5. `models.py`

* **Назначение**: Определение структур данных и моделей для базы данных (через SQLAlchemy или иной ORM).
* **Основные классы**:

  * `User`: Модель для хранения настроек каждого пользователя (например, чат\_id, предпочтения).
  * `Trade`: Модель для сохранения истории сделок (время, тикер, размер позиции, цена открытия/закрытия).
  * `Balance`: Текущий баланс и история изменений.
  * Если используется SQLite/Postgres/MySQL — создаются соответствующие таблицы.

> Структура моделей позволяет хранить полную историю работы бота и делает возможным построение отчетов.

---

### 6. `bot.py`

* **Назначение**: Реализация чат-бота (чаще всего Telegram) для взаимодействия с пользователем:

  * Регистрация пользователя.
  * Получение команд `/start`, `/help`, `/status`.
  * Отправка торговых сигналов в канал/группу/личные сообщения.
  * Обработка пользовательских запросов на баланс, историю сделок и т.п.

* **Ключевые компоненты**:

  * Подключение через `python-telegram-bot` (или аналогичную библиотеку).
  * Обработчики команд и сообщений (`handlers`).
  * Интеграция с другими модулями (`strategy`, `money`, `models`) для формирования ответов.

> **Замечание для ИИ**: Файл явно структурирован в виде «точка входа» для чат-бота, включает в себя асинхронные функции и callback-методы.

---

### 7. `app_server.py`

* **Назначение**: Веб-сервер (например, `Flask` или `FastAPI`), предоставляющий:

  * Страницу со сводной информацией о текущих сигналах.
  * Графики и визуализацию истории сделок (используя `analytics.html` и `index.html`).
  * API-эндпойнты для внешних запросов (например, получение JSON с последними сигналами).

* **Ключевые роуты**:

  * `GET /` — основная страница (отображается содержимое `index.html`).
  * `GET /analytics` — выводит `analytics.html` или динамически генерируемый отчет.
  * `GET /api/signals` — возвращает JSON с текущим состоянием сигналов.

> Интерфейс позволяет пользователю (или ИИ) программно извлекать данные о сигналах.

---

### 8. `main.py`

* **Назначение**: Главная точка входа для запуска всего приложения в разных режимах:

  * `python main.py --bot` — запускается только чат-бот.
  * `python main.py --server` — запускается веб-сервер.
  * `python main.py --strategy-loop` — непрерывный цикл расчета сигналов (Cron-подобный режим).
  * `python main.py --init-db` — инициализация базы данных (создание таблиц).

* **Логика**:

  1. Парсит аргументы командной строки (модуль `argparse`).
  2. Загружает конфигурацию из `config.py`.
  3. Вызывает соответствующую функцию/класс:

     * `run_bot()` (внутри `bot.py`).
     * `run_server()` (внутри `app_server.py`).
     * `run_strategy_loop()` (внутри `strategy.py` или отдельного модуля).
     * `init_db()` (внутри `models.py` или `main.py`).

> **Для ИИ**: Можно автоматически определять режим запуска и передавать специфические параметры для тестирования.

---

### 9. `analytics.html` и `index.html`

* **Назначение**: Статические шаблоны веб-страниц для отображения:

  * **`index.html`**: Основная страница веб-інтерфейса. Содержит таблицы/графики текущих сигналов, краткий обзор баланса, статистику по сделкам.
  * **`analytics.html`**: Расширенная страница с графиками (может использовать `Plotly` или встроенные JS-библиотеки) для углубленного анализа производительности стратегии.

> Если проект расширяется, сюда можно добавить React/Vue-фронтенд, однако сейчас используются статические HTML-шаблоны.

---

## Принцип работы и поток данных

1. **Инициализация**:

   * `main.py` считывает аргументы, загружает настройки из `config.py`, устанавливает подключение к базе данных.
   * При первом запуске (флаг `--init-db`) создаются таблицы.

2. **Сбор данных**:

   * Модуль `data_provider.py` запрашивает исторические или текущие рыночные данные (через REST или WebSocket API биржи).
   * Преобразованные данные сохраняются временно в виде `DataFrame`.

3. **Генерация сигналов**:

   * Класс `Strategy` из `strategy.py` принимает данные и рассчитывает торговые индикаторы.
   * Метод `generate_signal()` возвращает конкретный сигнал (`BUY/SELL/HOLD`).

4. **Управление капиталом**:

   * Модуль `money.py` получает сигнал и текущее состояние баланса.
   * Рассчитывается размер позиции и уровни стоп-лосс/тейк-профит.
   * Информация о будущей сделке сохраняется в БД (модель `Trade` в `models.py`).

5. **Отправка сигналов**:

   * Если генерируется новый сигнал, модуль `bot.py` формирует сообщение и отправляет его пользователям через чат-бот.
   * Параллельно `app_server.py` может обновить REST-API и веб-страницы.

6. **Сохранение данных и аналитика**:

   * Все сделки и изменения баланса сохраняются в таблицах.
   * По расписанию (Cron или внутренний таймер) генерируются отчеты и обновляется `analytics.html`.

> **Примечание**: Все компоненты могут запускаться как совместно, так и отдельно. Например, можно запустить лишь сервер для просмотра аналитики либо только бота.

---

## Запуск проекта

1. **Инициализация базы данных** (один раз):

   ```bash
   python main.py --init-db
   ```

2. **Запуск бесконечного цикла генерации сигналов**:

   ```bash
   python main.py --strategy-loop
   ```

   * Вычисления выполняются каждые N минут (параметр задается в `config.py`).

3. **Запуск чат-бота**:

   ```bash
   python main.py --bot
   ```

   * После старта бот автоматически подключается к Telegram/Discord, начинает слушать команды и отправлять сигналы при их появлении.

4. **Запуск веб-сервера**:

   ```bash
   python main.py --server
   ```

   * По умолчанию интерфейс доступен на `http://localhost:5000` или другом порту, указанном в `config.py`.

> Можно комбинировать: запустить стратегию, бот и сервер одновременно (либо организовать каждую службу в отдельном терминале/сервере).

---

## Примеры использования

1. **Получение текущего сигнала**:

   * Пользователь отправляет в Telegram боту команду `/signal`.
   * Бот (`bot.py`) вызывает `strategy.generate_signal()` и возвращает сообщение:

     ```text
     📈 Текущий сигнал: BUY
     Тикер: BTC/USD
     Цена: 60000
     ```

2. **Просмотр истории сделок через веб**:

   * Открыть `http://localhost:5000/analytics`.
   * На странице отображаются:

     * График изменения баланса.
     * Таблица с записями по каждому `Trade`.
     * Метрики: общая прибыль, максимальная просадка.

3. **Изменение параметров стратегии**:

   * В `config.py` изменить `SHORT_MA_PERIOD = 20` на `30`.
   * Перезапустить стратегию: `python main.py --strategy-loop`.
   * Новый расчет сигналов будет производиться с обновленными настройками.

---

## Рекомендации по расширению

1. **Дополнительные индикаторы**:

   * Реализовать новые функции расчета (Bollinger Bands, MACD, Stochastic RSI) в `strategy.py`.
   * Добавить параметризацию через `config.py`.

2. **Улучшение веб-интерфейса**:

   * Переписать `index.html` и `analytics.html` с использованием React/Vue для динамических графиков.
   * Подключить библиотеки визуализации (Chart.js, D3.js).

3. **Расширение типов ботов**:

   * Реализовать поддержку Discord (`discord.py`) либо других мессенджеров (Slack).
   * Добавить функции подписки на премиум-каналы, оплату подписок.

4. **Обработка ошибок и логирование**:

   * Использовать `logging` для записи ошибок и информационных сообщений.
   * Добавить автоматический перезапуск модулей при падении (supervisor/systemd).

5. **Тестирование и CI/CD**:

   * Написать модульные тесты (pytest) для `strategy.py`, `money.py`.
   * Настроить автоматическую проверку кода (GitHub Actions).

---

## Лицензия

Данный проект распространяется под лицензией MIT. Вы можете свободно использовать, изменять и распространять его при условии сохранения данного уведомления о лицензии.

```text
MIT License

Copyright (c) 2025 Руслан ДО.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction... (далее полный текст)
```

---

*README.md составлен таким образом, чтобы другие ИИ могли быстро освоить архитектуру, модули и принципы работы бота, а также расширить функциональность без глубокого изучения исходного кода.*

```
```
